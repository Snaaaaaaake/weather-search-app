(this["webpackJsonpweather-search-app"]=this["webpackJsonpweather-search-app"]||[]).push([[0],{76:function(e,t,n){"use strict";n.r(t);var a=n(4),r=n(0),c=n.n(r),o=n(9),i=n.n(o),l=n(24),s=n(26),u=n(49),d={city:null,isLoading:!1,error:null};var h={cityWeeklyWeather:null,isLoading:!0,error:null};var j={cache:{},cacheLength:[]};var p=Object(s.d)(Object(s.c)({cityState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_CITY_REQUEST":return{city:null,isLoading:!0,error:null};case"FETCH_CITY_SUCCESS":return{city:t.payload,isLoading:!1,error:null};case"FETCH_CITY_FAILURE":return{city:null,isLoading:!1,error:t.payload};default:return e}},cityWeeklyWeatherState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"FETCH_WEEKLY_WEATHER_REQUEST":return{cityWeeklyWeather:null,isLoading:!0,error:null};case"FETCH_WEEKLY_WEATHER_SUCCESS":return{cityWeeklyWeather:t.payload,isLoading:!1,error:null};case"FETCH_WEEKLY_WEATHER_FAILURE":return{cityWeeklyWeather:null,isLoading:!1,error:t.payload};default:return e}},cacheState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CACHE":return{cache:t.payload.cache,cacheLength:t.payload.cacheLength};default:return e}}}),Object(s.a)(u.a)),y=n(41),b=n(109),x=n(115),f=n(107),m=n(117),O=n(108),E=n(114),g=n(116),C=n(45);function v(e,t){var n=t().cacheState.cache;return n[e=Array.isArray(e)?e.join():e]?n[e]:null}var S=function(e,t){return function(n,a){var r=a().cacheState,c=r.cache,o=r.cacheLength;c[e=Array.isArray(e)?e.join():e]=t,o.length<10?o=[].concat(Object(C.a)(o),[e]):(delete c[o[0]],o=[].concat(Object(C.a)(o.slice(1)),[e])),n(function(e){return{type:"SET_CACHE",payload:e}}({cache:c,cacheLength:o}))}},W=function(e){return{type:"FETCH_CITY_SUCCESS",payload:e}},T=function(){return{type:"FETCH_WEEKLY_WEATHER_REQUEST"}},_=function(e){return{type:"FETCH_WEEKLY_WEATHER_SUCCESS",payload:e}},w=c.a.createContext(),k=n(105),H=function(){return Object(a.jsx)(x.a,{py:5,width:"300px",align:"center",children:Object(a.jsx)(k.a,{})})},L=function(e){return Object(a.jsx)(x.a,{align:"center",children:Object(a.jsx)(f.a,{variant:"h6",component:"h6",children:"".concat(e.error.message)})})};function A(e){return"https://openweathermap.org/img/wn/".concat(e,"@2x.png")}function F(e){return Math.round(+e-273.15)}var R=Object(O.a)({form:{margin:"40px 0",display:"flex",maxWidth:400},input:{flexGrow:1,marginRight:10},buttonContainer:{display:"flex",justifyContent:"center"},button:{display:"flex"}}),U={fetchCityThunkAction:function(e,t){return function(n,a){var r=v(t,a);r?n(W(r)):(n({type:"FETCH_CITY_REQUEST"}),e.getCity(t).then((function(e){n(W(e)),n(S(t,e))})).catch((function(e){return n({type:"FETCH_CITY_FAILURE",payload:e})})))}}},Y=Object(l.b)((function(e){return{cityState:e.cityState}}),U)((function(e){var t=Object(r.useContext)(w),n=R(),c=Object(r.useState)(""),o=Object(y.a)(c,2),i=o[0],l=o[1],s=e.fetchCityThunkAction,u=e.openModalHandler,d=e.cityState,h=d.city,j=d.isLoading,p=d.error;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("form",{className:n.form,onSubmit:function(e){e.preventDefault(),s(t,i.toLowerCase())},autoComplete:"off",children:[Object(a.jsx)(E.a,{className:n.input,id:"outlined-basic",onChange:function(e){return l(e.target.value)},label:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0433\u043e\u0440\u043e\u0434",value:i,variant:"outlined",required:!0,disabled:j,inputProps:{pattern:"^[\u0430-\u044f\u0410-\u042f\u0435\u0401a-zA-Z\\s\\-]+$"}}),Object(a.jsx)(g.a,{disabled:j,variant:"contained",type:"submit",color:"primary",children:"\u041d\u0430\u0439\u0442\u0438"})]}),j?Object(a.jsx)(H,{}):p?Object(a.jsx)(L,{error:p}):h?Object(a.jsx)(x.a,{className:n.buttonContainer,children:Object(a.jsxs)(g.a,{variant:"contained",color:"primary",className:n.button,onClick:u,children:[Object(a.jsx)("img",{src:A(h.weather[0].icon),alt:h.name}),Object(a.jsxs)(x.a,{children:[Object(a.jsx)(f.a,{variant:"body1",component:"h2",children:h.name}),Object(a.jsx)(f.a,{variant:"caption",component:"p",children:"".concat(F(h.main.temp),"\xb0C")})]})]})}):null]})})),I=n(110),K=n(111),N=n(112),D=n(113);function M(e){return e<10?"0".concat(e):e}function Q(e){return"".concat(M(e.getDate()),".").concat(M(e.getMonth()+1),".").concat(e.getFullYear())}var q={fetchWeeklyWeatherThunkAction:function(e){return function(t,n){var a=n().cityState.city.coord,r=a.lat,c=a.lon,o=v([r,c],n);o?t(_(o)):(t({type:"FETCH_WEEKLY_WEATHER_REQUEST"}),e.getWeeklyWeather(r,c).then((function(e){t(_(e.daily)),t(S([r,c],e.daily))})).catch((function(e){return t({type:"FETCH_WEEKLY_WEATHER_FAILURE",payload:e})})))}},fetchWeeklyWeatherRequestAction:T},z=Object(l.b)((function(e){return{cityState:e.cityState,cityWeeklyWeatherState:e.cityWeeklyWeatherState}}),q)((function(e){var t=Object(r.useContext)(w),n=e.onCloseHandler,c=e.fetchWeeklyWeatherThunkAction,o=e.fetchWeeklyWeatherRequestAction,i=e.cityState.city,l=e.cityWeeklyWeatherState,s=l.cityWeeklyWeather,u=l.isLoading,d=l.error,h=new Date(1e3*i.dt),j=Q(h),p=h.getHours();Object(r.useEffect)((function(){return c(t),function(){return o()}}),[o,c,t]);var y,m=function(){return Object(a.jsxs)(x.a,{mt:"15px",children:[Object(a.jsx)(f.a,{variant:"body1",component:"p",children:"\u0412 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0435 \u0434\u043d\u0438:"}),Object(a.jsx)(x.a,{display:"grid",gridTemplateColumns:"auto auto",children:u?Object(a.jsx)(H,{}):d?Object(a.jsx)(L,{error:d}):s.map((function(e,t){var n=Q(new Date(1e3*e.dt));return 0!==t&&Object(a.jsxs)(x.a,{mr:"10px",mt:"13px",children:[Object(a.jsx)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:n}),Object(a.jsx)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:"\u0414\u043d\u0451\u043c: ".concat(F(e.temp.day),"\xb0C")}),Object(a.jsx)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:"\u041d\u043e\u0447\u044c\u044e: ".concat(F(e.temp.night),"\xb0C")}),Object(a.jsx)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:e.weather[0].description[0].toUpperCase()+e.weather[0].description.substring(1)})]},"day_".concat(t))}))})]})};return Object(a.jsx)(b.a,{maxWidth:"xs",disableGutters:!0,children:Object(a.jsxs)(I.a,{children:[Object(a.jsx)(x.a,{width:"100px",mx:"auto",children:Object(a.jsx)(K.a,{component:"img",image:A(i.weather[0].icon)})}),Object(a.jsxs)(N.a,{children:[Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["\u0421\u0435\u0433\u043e\u0434\u043d\u044f, ",j,":"]}),Object(a.jsx)(f.a,{gutterBottom:!0,variant:"h4",component:"h2",children:i.name}),Object(a.jsxs)(f.a,{variant:"body1",component:"p",children:[F(i.main.temp),"\xb0C"]}),Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["\u041e\u0449\u0443\u0449\u0430\u0435\u0442\u0441\u044f \u043a\u0430\u043a ",F(i.main.feels_like),"\xb0C"]}),Object(a.jsx)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:i.weather[0].description[0].toUpperCase()+i.weather[0].description.substring(1)}),Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["\u0412\u0435\u0442\u0435\u0440 ",i.wind.speed," \u043c/\u0441"]}),Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 ",(y=i.main.pressure,Math.round(+y/1.33))," \u043c\u0440\u0441"]}),s&&p>6&&Object(a.jsxs)(f.a,{variant:"body2",color:"textSecondary",component:"p",children:["\u0422\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u043d\u043e\u0447\u044c\u044e: ",F(s[0].temp.night),"\xb0C"]}),Object(a.jsx)(m,{})]}),Object(a.jsx)(D.a,{children:Object(a.jsx)(g.a,{onClick:n,size:"small",color:"primary",children:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c"})})]})})})),B=n(40),G=n(53),J=n(55),P=n(54),Z=function(e){Object(J.a)(n,e);var t=Object(P.a)(n);function n(){var e;Object(B.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={hasError:!1},e}return Object(G.a)(n,[{key:"render",value:function(){return this.state.hasError?Object(a.jsx)(L,{error:this.state.hasError}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:e}}}]),n}(c.a.Component),$=Object(O.a)({rootContainer:{marginTop:40,padding:"0 20px"},titleContainer:{padding:"0 20px"},modal:{display:"grid",alignItems:"center",justifyContent:"center",overflowY:"auto"}}),V=function(){var e=$(),t=Object(r.useState)(!1),n=Object(y.a)(t,2),c=n[0],o=n[1];return Object(a.jsxs)(b.a,{className:e.rootContainer,maxWidth:"xs",children:[Object(a.jsx)(x.a,{className:e.titleContainer,children:Object(a.jsx)(f.a,{align:"center",variant:"h3",component:"h1",children:"\u041f\u043e\u0438\u0441\u043a \u043f\u043e\u0433\u043e\u0434\u044b"})}),Object(a.jsx)(Z,{children:Object(a.jsx)(Y,{openModalHandler:function(){return o(!0)}})}),Object(a.jsx)(m.a,{className:e.modal,open:c,onClose:function(){return o(!1)},disableAutoFocus:!0,disableEnforceFocus:!0,children:Object(a.jsx)(x.a,{children:Object(a.jsx)(Z,{children:Object(a.jsx)(z,{onCloseHandler:function(){return o(!1)}})})})})]})};function X(e){if(!e.ok)throw new Error("\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e");return e.json()}var ee=new function e(){var t=this;Object(B.a)(this,e),this.getCity=function(e){var n="".concat(t.url,"weather?q=").concat(e,"&appid=").concat(t.apiKey,"&lang=").concat(t.lang);return fetch(n).then(X)},this.getWeeklyWeather=function(e,n){var a="".concat(t.url,"onecall?lat=").concat(e,"&lon=").concat(n,"&exclude=current,minutely,hourly&appid=").concat(t.apiKey,"&lang=").concat(t.lang);return fetch(a).then((function(e){return e.ok?e.json():new Error(e.status)}))},this.url="https://api.openweathermap.org/data/2.5/",this.apiKey="9a69c63930e012b4ba90d3284ead1e6d",this.lang="ru"};i.a.render(Object(a.jsx)(l.a,{store:p,children:Object(a.jsx)(w.Provider,{value:ee,children:Object(a.jsx)(V,{})})}),document.getElementById("root"))}},[[76,1,2]]]);
//# sourceMappingURL=main.afe8e6ba.chunk.js.map